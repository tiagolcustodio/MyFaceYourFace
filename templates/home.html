{% extends "base.html" %}
{% block content %}

<div class="layout">
  <div class="col-left">
    {% if user.profile_pic_path %}
      <img class="avatar-img" src="{{ url_for('static', filename=user.profile_pic_path) }}" alt="Profile Picture">
    {% else %}
      <div class="avatar-placeholder"></div>
    {% endif %}
  </div>

  <div class="col-main">
    <h2>Home</h2>

    <div class="summary">
      <div><b>Hello {{ user.display_name }}</b></div>

      {% if messages_unread_count > 0 %}
        <div>You have messages ({{ messages_unread_count }})</div>
      {% endif %}

      {% if pending_requests_count > 0 %}
        <div>You have friend requests ({{ pending_requests_count }}) â€” <a class="inline-link" href="{{ url_for('friend_requests') }}">View</a></div>
      {% endif %}
    </div>

    <h3>People you may know:</h3>

    {% if user_cards|length == 0 %}
      <div class="muted">No suggestions right now.</div>
    {% else %}
      <div class="user-list">
        {% for u in user_cards %}
          <div class="user-card">
            <div class="mini-avatar"></div>
            <div>
              <div class="user-name">{{ u.display_name }}</div>
              <div class="user-handle">@{{ u.username }}</div>
            </div>
            <div>
              {% if u.can_request %}
                <form method="post" action="{{ url_for('send_friend_request', to_user_id=u.id) }}">
                  <button type="submit">{{ u.label }}</button>
                </form>
              {% else %}
                <button class="disabled" type="button">{{ u.label }}</button>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if recent_activities and recent_activities|length > 0 %}
      <div class="panel" style="margin-top:16px;">
        <h3 style="margin-top:0;">Recent Activities</h3>
        <div class="activities">
          {% for a in recent_activities %}
            <div class="activity-item">{{ a.text }}</div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

  </div>

  <div class="col-right">
    <div class="sidebox">
      <div class="sidebox-header">
        <h3>Friends</h3>
        <a class="sidebox-link" href="{{ url_for('friends_page') }}">See all friends</a>
      </div>

      {% if friends_random|length == 0 %}
        <div class="muted">No friends yet.</div>
      {% else %}
        <div class="grid-3">
          {% for f in friends_random %}
            <div class="grid-item">
              <a href="{{ url_for('user_profile', username=f.username) }}" class="grid-link">
                {% if f.profile_pic_path %}
                  <img class="square-img" src="{{ url_for('static', filename=f.profile_pic_path) }}" alt="Friend">
                {% else %}
                  <div class="friend-avatar"></div>
                {% endif %}
                <div class="grid-name">{{ f.display_name }}</div>
              </a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div class="sidebox">
      <div class="sidebox-header">
        <h3>Communities</h3>
        <a class="sidebox-link" href="{{ url_for('communities_page') }}">See all</a>
      </div>

      {% if communities_random|length == 0 %}
        <div class="muted">No communities yet.</div>
      {% else %}
        <div class="grid-3">
          {% for c in communities_random %}
            <div class="grid-item">
              <a href="{{ url_for('community_page', cid=c.id) }}" class="grid-link">
                {% if c.icon_path %}
                  <img class="square-img" src="{{ url_for('static', filename=c.icon_path) }}" alt="Community">
                {% else %}
                  <div class="community-avatar"></div>
                {% endif %}
                <div class="grid-name">{{ c.name }}</div>
              </a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
