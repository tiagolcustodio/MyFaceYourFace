{% extends "base.html" %}
{% block content %}

<h2>Edit Profile</h2>

<div class="panel">
  <form method="post" action="{{ url_for('edit_profile_post') }}" enctype="multipart/form-data">

    <label>Upload Profile Picture (PNG/JPG)</label>
    <input type="file" name="profile_pic" accept=".png,.jpg,.jpeg">

    <label>Name</label>
    <input name="display_name" value="{{ user.display_name }}" required>

    <label>Description</label>
    <textarea name="description" rows="4" maxlength="500">{{ user.description or '' }}</textarea>

    <hr class="soft-hr">

    <label>Birthdate</label>
    <input type="date" name="birthdate" value="{{ user.birthdate or '' }}">

    <label>Sex</label>
    <div class="radio-group">
      {% for opt in sex_options %}
        <label class="radio-item">
          <input class="toggle-radio" type="radio" name="sex" value="{{ opt }}" {% if user.sex == opt %}checked{% endif %}>
          <span>{{ opt }}</span>
        </label>
      {% endfor %}
    </div>

    <label>Sexual orientation</label>
    <div class="radio-group">
      {% for opt in orientation_options %}
        <label class="radio-item">
          <input class="toggle-radio" type="radio" name="sexual_orientation" value="{{ opt }}" {% if user.sexual_orientation == opt %}checked{% endif %}>
          <span>{{ opt }}</span>
        </label>
      {% endfor %}
    </div>

    <label>Relationship</label>
    <div class="radio-group">
      {% for opt in relationship_options %}
        <label class="radio-item">
          <input class="toggle-radio" type="radio" name="relationship_status" value="{{ opt }}" {% if user.relationship_status == opt %}checked{% endif %}>
          <span>{{ opt }}</span>
        </label>
      {% endfor %}
    </div>

    <label>Political orientation</label>
    <div class="radio-group">
      {% for opt in politics_options %}
        <label class="radio-item">
          <input class="toggle-radio" type="radio" name="political_orientation" value="{{ opt }}" {% if user.political_orientation == opt %}checked{% endif %}>
          <span>{{ opt }}</span>
        </label>
      {% endfor %}
    </div>

    <label>Favorite team</label>
    <input name="favorite_team" maxlength="80" value="{{ user.favorite_team or '' }}">

    <label>Main hobby</label>
    <input name="main_hobby" maxlength="80" value="{{ user.main_hobby or '' }}">

    <div class="row-actions">
      <button type="submit">Save</button>
      <a class="inline-link" href="{{ url_for('my_profile_redirect') }}">Cancel</a>
    </div>
  </form>
</div>

<script>
  // âœ… allow "uncheck" radio: click again on checked -> clears selection
  (function(){
    const radios = document.querySelectorAll("input.toggle-radio[type='radio']");
    radios.forEach(r => {
      r.addEventListener("mousedown", function(e){
        this.dataset.wasChecked = this.checked ? "1" : "0";
      });
      r.addEventListener("click", function(e){
        if (this.dataset.wasChecked === "1") {
          this.checked = false;
        }
        this.dataset.wasChecked = "";
      });
    });
  })();
</script>

{% endblock %}
