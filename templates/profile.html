{% extends "base.html" %}
{% block content %}

<div class="layout">
  <div class="col-left">
    {% if profile_user.profile_pic_path %}
      <img class="avatar-img" src="{{ url_for('static', filename=profile_user.profile_pic_path) }}" alt="Profile Picture">
    {% else %}
      <div class="avatar-placeholder"></div>
    {% endif %}

    {% if is_owner %}
      <div style="margin-top:10px;">
        <a class="inline-link" href="{{ url_for('edit_profile') }}">Edit Profile</a>
      </div>
    {% endif %}
  </div>

  <div class="col-main">
    <h2>Profile</h2>

    <div class="profile-box">
      <div><b>Name:</b> {{ profile_user.display_name }}</div>
      <div><b>Username:</b> @{{ profile_user.username }}</div>

      {% if profile_user.description %}
        <div><b>Description:</b> {{ profile_user.description }}</div>
      {% endif %}

      <div class="profile-grid" style="margin-top:10px;">
        {% if profile_user.birthdate %}<div><b>Birthdate:</b> {{ profile_user.birthdate }}</div>{% endif %}
        {% if profile_user.sex %}<div><b>Sex:</b> {{ profile_user.sex }}</div>{% endif %}
        {% if profile_user.sexual_orientation %}<div><b>Sexual orientation:</b> {{ profile_user.sexual_orientation }}</div>{% endif %}
        {% if profile_user.relationship_status %}<div><b>Relationship:</b> {{ profile_user.relationship_status }}</div>{% endif %}
        {% if profile_user.political_orientation %}<div><b>Political orientation:</b> {{ profile_user.political_orientation }}</div>{% endif %}
        {% if profile_user.favorite_team %}<div><b>Favorite team:</b> {{ profile_user.favorite_team }}</div>{% endif %}
        {% if profile_user.main_hobby %}<div><b>Main hobby:</b> {{ profile_user.main_hobby }}</div>{% endif %}
      </div>
    </div>

    {% if (not is_owner) and is_friend %}
      <div class="message-compose">
        <h3>Leave a message</h3>
        <form method="post" action="{{ url_for('post_message', username=profile_user.username) }}">
          <textarea name="content" rows="3" maxlength="500" placeholder="Write something..."></textarea>
          <div class="compose-actions">
            <button type="submit">Send</button>
          </div>
        </form>
      </div>
    {% elif not is_owner %}
      <div class="muted" style="margin-top:12px;">
        You can only post messages to friends.
      </div>
    {% endif %}

    <h3 style="margin-top:18px;">Messages</h3>

    {% if wall_messages|length == 0 %}
      <div class="muted">No messages yet.</div>
    {% else %}
      <div class="wall">
        {% for m in wall_messages %}
          <div class="wall-item">
            <div class="wall-left">
              <a href="{{ url_for('user_profile', username=m.from_username) }}" class="avatar-link">
                {% if m.from_pic %}
                  <img class="wall-avatar-img" src="{{ url_for('static', filename=m.from_pic) }}" alt="Sender">
                {% else %}
                  <div class="wall-avatar"></div>
                {% endif %}
                <div class="wall-name">{{ m.from_name }}</div>
              </a>
              <div class="muted" style="margin-top:6px;">{{ m.created_at|fmt_dt }}</div>
            </div>

            <div class="wall-right">
              <div class="wall-bubble-row">
                <div class="wall-bubble">{{ m.content }}</div>

                {% if viewer.id == profile_user.id or viewer.id == m.from_user_id %}
                  <form method="post"
                        action="{{ url_for('delete_profile_message', message_id=m.id) }}"
                        onsubmit="return confirm('Delete this message?');"
                        class="delete-form">
                    <input type="hidden" name="redirect_to" value="{{ request.full_path }}">
                    <button type="submit" class="icon-delete" aria-label="Delete">X</button>
                  </form>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      {% if wall_pagination.show %}
        <div class="pagination">
          {% if wall_pagination.has_prev %}
            <a class="page-link" href="{{ url_for('user_profile', username=profile_user.username, page=wall_pagination.prev_page) }}">Prev</a>
          {% endif %}

          <span class="page-info">Page {{ wall_pagination.page }} / {{ wall_pagination.total_pages }}</span>

          {% if wall_pagination.has_next %}
            <a class="page-link" href="{{ url_for('user_profile', username=profile_user.username, page=wall_pagination.next_page) }}">Next</a>
          {% endif %}
        </div>
      {% endif %}
    {% endif %}
  </div>

  <div class="col-right">
    <div class="sidebox">
      <div class="sidebox-header">
        <h3>Friends</h3>
        <a class="sidebox-link" href="{{ url_for('friends_page') }}">See all friends</a>
      </div>

      {% if friends_random|length == 0 %}
        <div class="muted">No friends yet.</div>
      {% else %}
        <div class="grid-3">
          {% for f in friends_random %}
            <div class="grid-item">
              <a href="{{ url_for('user_profile', username=f.username) }}" class="grid-link">
                {% if f.profile_pic_path %}
                  <img class="square-img" src="{{ url_for('static', filename=f.profile_pic_path) }}" alt="Friend">
                {% else %}
                  <div class="friend-avatar"></div>
                {% endif %}
                <div class="grid-name">{{ f.display_name }}</div>
              </a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div class="sidebox">
      <div class="sidebox-header">
        <h3>Communities</h3>
        {% if communities_all_for_profile|length > 0 %}
          <a class="sidebox-link" href="{{ url_for('user_communities', username=profile_user.username) }}">See all</a>
        {% endif %}
      </div>

      {% if communities_random|length == 0 %}
        <div class="muted">No communities yet.</div>
      {% else %}
        <div class="grid-3">
          {% for c in communities_random %}
            <div class="grid-item">
              <a href="{{ url_for('community_page', cid=c.id) }}" class="grid-link">
                {% if c.icon_path %}
                  <img class="square-img" src="{{ url_for('static', filename=c.icon_path) }}" alt="Community">
                {% else %}
                  <div class="community-avatar"></div>
                {% endif %}
                <div class="grid-name">{{ c.name }}</div>
              </a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
